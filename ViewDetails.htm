<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta charset="utf-8">
		
    <title>View Details on this Location</title>

		<script src="./jquery.js"></script>
    <script src="./jquery.csv-0.71.js"></script>
    
		<script>
			
      // Global Variables
      var xmlDoc;

      // Wait until the DOM has loaded before querying the document
			$(document).ready(function(){

        var UniqueID;
        
        //Create a custom event for when the XML file is finished loading.
        var XMLevent = new CustomEvent('XMLLoaded', {
        });
        
        // RETRIEVE THE URL WHICH CONTAINS THE PASSED IN UNIQUEID
        //Create a variable for the URL (not a string).
        var locate = window.location 
        //Dump the URL data into the hidden form, forcing it into a string of text.
        document.hiddenform.hiddentext.value = locate 
        //Read the URL out of the hidden text box.
        var text = document.hiddenform.hiddentext.value 

        //This function retrieves the UniqueID value from the URL string.
        function delineate2(str){
            point = str.lastIndexOf("=");
            return(str.substring(point+1,str.length));
        }
        
        UniqueID = delineate2(text);
        
        //document.write("UniqueID is " +UniqueID);
        
        // Retrieve the XML file for this marker.
        // Call the XMLevent after the file finishes loading.
        var xmlFile = new XMLHttpRequest();
        var FileName = "http://ec2-54-201-251-131.us-west-2.compute.amazonaws.com/locations/" + UniqueID + ".xml";
        xmlFile.open("GET", FileName, true);
        xmlFile.onreadystatechange = function() {
          if (xmlFile.readyState === 4) {  // Makes sure the document is ready to parse.
            if (xmlFile.status === 200) {  // Makes sure it's found the file.
              
              // Parse the XML from the raw text
              var parser = new DOMParser();
              xmlDoc = parser.parseFromString(xmlFile.responseText, "text/xml");
              
              // Call the XMLEvent to signal that the XML is finished loading
              document.dispatchEvent(XMLevent)
              
            }
          }
        }
        xmlFile.send(null); //Execute the file request.
        
                
        // Create an event listener that executes after the XML file has finished loading.
				document.addEventListener('XMLLoaded', function (e) {
debugger;
          var XMLStrings = ValidateXML();  //Validate the XML before writing it to the webpage.
                          //This handles empty XML entities.
        
          var contentstring = '<div id="LocationInfo">' +
            '<h1>' + XMLStrings.title + '</h1>' +
            '<br>' +
            '<p> Summary: ' + XMLStrings.summery + '</p>' +
            '<br>' +
            '<p> Last Updated by: ' + XMLStrings.username + '</p>' +
            '<br>' +
            '<p> Revision number: ' + XMLStrings.currentversion + '</p>' +
            '<br>' +
            '<p> Updated on: ' + XMLStrings.dateupdated + '</p>' +
            '<br>' +
            '<p> Latitude: ' + XMLStrings.latitude + '</p>' +
            '<br>' +
            '<p> Longitude: ' + XMLStrings.longitude + '</p>' +
            '<br>' +
            '<p> Approach and Anchorage: ' + XMLStrings.approach + '</p>' +
            '<br>' +
            '<p> Description: ' + XMLStrings.description + '</p>' +
            '<br>' +
            '<p> NOAA Image: ' + XMLStrings.noaaimage + '</p>' +
            '<br>' +
            '<p> Image 1: ' + XMLStrings.image + '</p>' +
            '<br>' +
            '<p><a href="http://ec2-54-201-251-131.us-west-2.compute.amazonaws.com/ModifyLocation.htm?UniqueID='+UniqueID+'">Modify Location Information</a></p>'+
            '</div>';
          
          //$(document).append(contentstring);
          //document.write(contentstring);
          
          $('#NOAAImage').html('<img src="'+XMLStrings.noaaimage+'">');
          $('#Summary').html(XMLStrings.summery);
          $('#Approach').html(XMLStrings.approach);
          $('#Description').html(XMLStrings.approach);

				}, false);

        function ValidateXML() {
        debugger;
          var XMLStrings = new Object();
          
          if(xmlDoc.getElementsByTagName("Title")[0].childNodes[0] != undefined)
            XMLStrings.title = xmlDoc.getElementsByTagName("Title")[0].childNodes[0].nodeValue;
          else
            XMLStrings.title = "";
            
          if(xmlDoc.getElementsByTagName("Summary")[0].childNodes[0] != undefined)
            XMLStrings.summery = xmlDoc.getElementsByTagName("Summary")[0].childNodes[0].nodeValue;
          else
            XMLStrings.summery = "";
            
          if(xmlDoc.getElementsByTagName("UserName")[0].childNodes[0] != undefined)
            XMLStrings.username = xmlDoc.getElementsByTagName("UserName")[0].childNodes[0].nodeValue;
          else
            XMLStrings.username = "";
            
          if(xmlDoc.getElementsByTagName("CurrentVersion")[0].childNodes[0] != undefined)
            XMLStrings.currentversion = xmlDoc.getElementsByTagName("CurrentVersion")[0].childNodes[0].nodeValue;
          else
            XMLStrings.currentversion = "";
            
          if(xmlDoc.getElementsByTagName("DateUpdated")[0].childNodes[0] != undefined)
            XMLStrings.dateupdated = xmlDoc.getElementsByTagName("DateUpdated")[0].childNodes[0].nodeValue;
          else
            XMLStrings.dateupdated = "";
            
          if(xmlDoc.getElementsByTagName("Latitude")[0].childNodes[0] != undefined)
            XMLStrings.latitude = xmlDoc.getElementsByTagName("Latitude")[0].childNodes[0].nodeValue;
          else
            XMLStrings.latitude = "";
            
          if(xmlDoc.getElementsByTagName("Longitude")[0].childNodes[0] != undefined)
            XMLStrings.longitude = xmlDoc.getElementsByTagName("Longitude")[0].childNodes[0].nodeValue;
          else
            XMLStrings.longitude = "";
            
          if(xmlDoc.getElementsByTagName("Approach")[0].childNodes[0] != undefined)
            XMLStrings.approach = xmlDoc.getElementsByTagName("Approach")[0].childNodes[0].nodeValue;
          else
            XMLStrings.approach = "";
            
          if(xmlDoc.getElementsByTagName("Description")[0].childNodes[0] != undefined)
            XMLStrings.description = xmlDoc.getElementsByTagName("Description")[0].childNodes[0].nodeValue;
          else
            XMLStrings.description = "";
            
          if(xmlDoc.getElementsByTagName("NOAAImage")[0].childNodes[0] != undefined)
            XMLStrings.noaaimage = xmlDoc.getElementsByTagName("NOAAImage")[0].childNodes[0].nodeValue;
          else
            XMLStrings.noaaimage = "";
            
          if(xmlDoc.getElementsByTagName("Image")[0].childNodes[0] != undefined)
            XMLStrings.image = xmlDoc.getElementsByTagName("Image")[0].childNodes[0].nodeValue;
          else
            XMLStrings.image = "";
            
          return XMLStrings;
        }
        
			});
		</script>
	</head>
  
	<body>

    <!-- Create a hidden form. This is used to process the URL. -->
    <FORM NAME="hiddenform">
    <INPUT TYPE="hidden" NAME="hiddentext" SIZE="35">
    </form>

    <!--
    <div id="status">
        <p>Loading the page...</p>
    </div>
    -->
    
    <table style="width:100%" id="xmlcontent" border="0">
      <tr>
        <td id="NOAAImage" style="width:50%">        
        </td>
        <td id="Summary">        
        </td>
      </tr>
      
      <tr>
        <td colspan="2"><br></br><h3>Approach:</h3></td>
      </tr>
      <tr>
        <td colspan="2" id="Approach">
        </td>
      </tr>
      
      <tr>
        <td colspan="2"><br></br><h3>Description:</h3></td>
      </tr>
      <tr>
        <td colspan="2" id="Description">
        </td>
      </tr>
      
    </table>
    
  </body>
</html>